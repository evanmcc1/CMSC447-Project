<!DOCTYPE html>

<html lang="en">
<head>
    <title>Manager</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="leaflet/leaflet.css"/>
    <link rel="stylesheet" type="text/css" href="tabulator/dist/css/tabulator_midnight.min.css"/>
    <script type="text/javascript" src="leaflet/leaflet.js"></script>
    <script type="text/javascript" src="tabulator/dist/js/tabulator_core.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/primary.css"/>
    <link rel="stylesheet" type="text/css" href="css/mapInterface.css"/>
    <link rel="stylesheet" type="text/css" href="css/operationsManager.css"/>
</head>
<body>
<table id="content">
    <tbody>
    <tr>
        <td id="left_half">
            <div id="leaflet_map"></div>
        </td>
        <td id="right_half">
            <div class="toolbar" id="nav_toolbar"> <!-- Navigation buttons -->
                <button>OC</button>
                <button>Ticket form</button>
                <button>Logout</button>
            </div>
            <!--<iframe id="filter_form" src="php/search.html"></iframe>-->
            <div id="filter_content" data-state="hidden"></div>
            <div class="toolbar">
                Event feed
                <button id="filter_button" hidden="hidden">Filter</button>
                <button id="filter_button_2">Filter</button>
            </div>

            <!--// Dynamically show/hide filter buttons-->
            <script>

                function create_el(vals) {
                    let el;
                    for (let key in vals) {
                        if (key === "t") {
                            el = document.createElement(vals[key]);
                        } else if (key !== "display") {
                            el.setAttribute(key, vals[key]);
                        } else {
                            el.innerHTML = vals["display"];
                        }
                    }
                    return el;
                }

                function toggle_filters() {
                    var filters = document.querySelector("#filter_content");

                    if (filters.getAttribute("data-state") === "hidden") {
                        var client = new XMLHttpRequest();
                        client.open('GET', 'data/filters.json');
                        client.onreadystatechange = function () {
                            if (client.readyState == 4 && client.status == 200) {
                                r = JSON.parse(client.responseText);

                                var form = create_el({"t": "form"});
                                var fields = r["filter_by_name"];
                                console.log(fields.length);
                                for (let i = 0; i < fields.length; ++i) {
                                    new_el = create_el(r["filter_by_name"][i]);
                                    form.appendChild(new_el)
                                }
                                filters.appendChild(form);
                                filters.setAttribute("data-state", "vis");
                            }
                        }
                        client.send();
                    }

                    else {
                        filters.innerHTML = "";
                        filters.setAttribute("data-state", "hidden");
                    }

                }

                var r;
                document.querySelector("#filter_button_2").addEventListener("click", toggle_filters);
            </script>
            <div id="filtered_event_feed"></div>
            <div id="groups_toolbar" class="toolbar">
                Groups
                <button>Submit</button>
            </div>
            <div id="grouped_events_table"></div>
        </td>
    </tr>
    </tbody>
</table>
<script type="text/javascript" src="js/rrMapTableInterface.js"></script>
<script type="text/javascript" src="js/omMapInterface.js"></script>
</body>
</html>